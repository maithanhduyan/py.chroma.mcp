# Generated by Copilot
"""
ğŸš€ MCP ChromaDB Embedding Integration Demo
Showcase kháº£ nÄƒng semantic search tiáº¿ng Viá»‡t vá»›i real data
"""

import logging
from src.tools import MCPTools

# CÃ i Ä‘áº·t logging Ä‘á»ƒ demo clean hÆ¡n
logging.basicConfig(level=logging.WARNING)

def demo_vietnamese_semantic_search():
    """Demo comprehensive cho kháº£ nÄƒng semantic search tiáº¿ng Viá»‡t"""
    
    print("ğŸš€ MCP ChromaDB Embedding Integration - Vietnamese Semantic Search Demo")
    print("=" * 80)
    print("ğŸ¯ Showcasing: Real Vietnamese content processing & intelligent search")
    print()
    
    # Khá»Ÿi táº¡o tools
    print("ğŸ”§ Initializing MCP Tools with embedding integration...")
    tools = MCPTools()
    print("âœ… Ready!")
    print()
    
    # Demo data: Ná»™i dung cÃ´ng nghá»‡ Viá»‡t Nam
    tech_content = """
    NgÃ nh cÃ´ng nghá»‡ thÃ´ng tin Viá»‡t Nam Ä‘ang tráº£i qua giai Ä‘oáº¡n phÃ¡t triá»ƒn máº¡nh máº½. 
    CÃ¡c startup tech nhÆ° VinTech, FPT, Viettel Ä‘ang Ä‘áº§u tÆ° máº¡nh vÃ o AI vÃ  blockchain.
    
    Vá» trÃ­ tuá»‡ nhÃ¢n táº¡o, VinAI Research Ä‘Ã£ phÃ¡t triá»ƒn thÃ nh cÃ´ng mÃ´ hÃ¬nh ngÃ´n ngá»¯ 
    lá»›n PhoGPT cho tiáº¿ng Viá»‡t. MÃ´ hÃ¬nh nÃ y cÃ³ kháº£ nÄƒng hiá»ƒu vÃ  táº¡o ra vÄƒn báº£n 
    tiáº¿ng Viá»‡t tá»± nhiÃªn vá»›i Ä‘á»™ chÃ­nh xÃ¡c cao.
    
    Trong lÄ©nh vá»±c fintech, cÃ¡c á»©ng dá»¥ng nhÆ° MoMo, ZaloPay, ViettelPay Ä‘ang 
    cáº¡nh tranh máº¡nh máº½. Sá»‘ lÆ°á»£ng ngÆ°á»i dÃ¹ng thanh toÃ¡n Ä‘iá»‡n tá»­ tÄƒng 300% 
    trong 2 nÄƒm qua.
    
    Blockchain vÃ  cryptocurrency cÅ©ng nháº­n Ä‘Æ°á»£c sá»± quan tÃ¢m lá»›n. Viá»‡t Nam 
    Ä‘á»©ng top 5 tháº¿ giá»›i vá» adoption rate cá»§a crypto. Nhiá»u dá»± Ã¡n DeFi vÃ  
    NFT made-in-Vietnam Ä‘Ã£ ra máº¯t thÃ nh cÃ´ng.
    
    Vá» game development, Viá»‡t Nam cÃ³ VNG, Gamota, Amanotes - cÃ¡c studio 
    phÃ¡t triá»ƒn game mobile thÃ nh cÃ´ng trÃªn thá»‹ trÆ°á»ng quá»‘c táº¿. Revenue 
    tá»« game xuáº¥t kháº©u Ä‘áº¡t 500 triá»‡u USD nÄƒm 2023.
    """
    
    collection_name = "vietnam_tech_demo"
    
    try:
        # Setup collection
        print("ğŸ“ Setting up demo collection...")
        try:
            tools.call_tool("delete_collection", {"name": collection_name})
        except:
            pass
            
        tools.call_tool("create_collection", {
            "name": collection_name,
            "metadata": {"domain": "technology", "language": "vietnamese", "demo": True}
        })
        
        # Intelligent chunking
        print("ğŸ§© Performing intelligent chunking...")
        chunks = tools.call_tool("chunk_text_intelligent", {
            "text": tech_content,
            "chunk_size": 250,
            "overlap": 30
        })
        print(f"   â†’ Split into {len(chunks)} semantic chunks")
        
        # Add with rich metadata  
        print("ğŸ“ Ingesting content with metadata...")
        tools.call_tool("add_documents", {
            "collection_name": collection_name,
            "documents": chunks,
            "ids": [f"tech_chunk_{i}" for i in range(len(chunks))],
            "metadatas": [
                {
                    "category": "ai" if "AI" in chunk or "trÃ­ tuá»‡ nhÃ¢n táº¡o" in chunk else
                              "fintech" if "fintech" in chunk or "thanh toÃ¡n" in chunk else  
                              "blockchain" if "blockchain" in chunk or "crypto" in chunk else
                              "gaming" if "game" in chunk else "general",
                    "companies": "VinAI" if "VinAI" in chunk else
                               "VNG" if "VNG" in chunk else  
                               "Viettel" if "Viettel" in chunk else "multiple",
                    "chunk_index": i,
                    "has_numbers": any(char.isdigit() for char in chunk)
                }
                for i, chunk in enumerate(chunks)
            ]
        })
        print("âœ… Content ingested successfully!")
        print()
        
        # Demo queries
        demo_queries = [
            {
                "query": "AI vÃ  machine learning á»Ÿ Viá»‡t Nam",
                "expected": "VinAI Research, PhoGPT"
            },
            {
                "query": "Thanh toÃ¡n Ä‘iá»‡n tá»­ vÃ  fintech", 
                "expected": "MoMo, ZaloPay, 300% tÄƒng trÆ°á»Ÿng"
            },
            {
                "query": "Game mobile vÃ  xuáº¥t kháº©u",
                "expected": "VNG, Gamota, 500 triá»‡u USD"  
            },
            {
                "query": "Blockchain vÃ  cryptocurrency adoption",
                "expected": "Top 5 tháº¿ giá»›i, DeFi, NFT"
            }
        ]
        
        print("ğŸ” SEMANTIC SEARCH DEMO")
        print("-" * 50)
        
        for i, demo in enumerate(demo_queries, 1):
            print(f"\n{i}. Query: '{demo['query']}'")
            print(f"   Expected: {demo['expected']}")
            
            results = tools.call_tool("query_collection", {
                "collection_name": collection_name,
                "query_texts": [demo['query']],
                "n_results": 2
            })
            
            if results and 'documents' in results:
                print("   ğŸ“‹ Results:")
                for j, (doc, distance) in enumerate(zip(results['documents'][0], results['distances'][0])):
                    print(f"      {j+1}. [{distance:.3f}] {doc[:120]}...")
            print()
        
        # Metadata filtering demo
        print("ğŸ·ï¸ METADATA FILTERING DEMO")
        print("-" * 50)
        
        categories = ["ai", "fintech", "blockchain", "gaming"]
        for category in categories:
            results = tools.call_tool("query_collection", {
                "collection_name": collection_name,
                "query_texts": [f"cÃ´ng nghá»‡ {category}"],
                "n_results": 1,
                "where": {"category": category}
            })
            
            if results and 'documents' in results and results['documents'][0]:
                doc = results['documents'][0][0]
                distance = results['distances'][0][0]
                print(f"ğŸ“‚ {category.upper():10} [{distance:.3f}]: {doc[:80]}...")
        
        print()
        print("ğŸ¯ ADVANCED FEATURES DEMO")
        print("-" * 50)
        
        # Model info
        model_info = tools.call_tool("get_embedding_model_info", {})
        print(f"ğŸ¤– Current embedding model: {model_info}")
        
        # Collections overview
        collections = tools.call_tool("list_collections", {})
        print(f"ğŸ“Š Total collections: {len(collections)}")
        print(f"    Active collections: {', '.join(collections)}")
        
        print()
        print("ğŸ† DEMO COMPLETED SUCCESSFULLY!")
        print("=" * 80)
        print("âœ¨ Key Capabilities Demonstrated:")
        print("   ğŸ§  Intelligent Vietnamese text understanding")
        print("   ğŸ” Semantic search vá»›i context awareness") 
        print("   ğŸ·ï¸ Rich metadata filtering")
        print("   ğŸ§© Smart chunking for optimal retrieval")
        print("   ğŸ’ª Robust fallback mechanisms")
        print("   ğŸš€ Production-ready performance")
        print()
        print("ğŸ”— Ready for integration with MCP clients!")
        
    except Exception as e:
        print(f"âŒ Demo error: {e}")
        import traceback
        traceback.print_exc()

if __name__ == "__main__":
    demo_vietnamese_semantic_search()
